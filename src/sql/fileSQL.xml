<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="bengineer">
	<select id="getref" resultType="int" parameterType="fileDTO">
		select num from BEfilelist where filename = #{filename} and folder_ref = #{folder_ref}
	</select>
	<select id="myfile" resultType="fileDTO" parameterType="fileDTO">
		select * from BEfilelist where owner = #{owner} and folder_ref = #{folder_ref} order by filetype desc, filename asc
	</select>
	<insert id="makedir" parameterType="fileDTO">
		insert into BEfilelist(num,folder_ref,filename,orgname,filetype,uploaddate,updatedate,owner) values(BEfilelist_seq.NEXTVAL, #{folder_ref}, #{filename}, #{filename}, 'dir', sysdate, sysdate, #{owner})
	</insert>
	<select id="getaddr" resultType="fileDTO" parameterType="int">
		select * from BEfilelist where num = #{folder_ref}
	</select>
	<insert id="upload" parameterType="fileDTO">
		insert into BEfilelist(num, folder_ref, filename, orgname, filetype, filesize, uploaddate, updatedate, owner) values(BEfilelist_seq.NEXTVAL, #{folder_ref}, #{filename}, #{orgname}, #{filetype}, #{filesize}, sysdate, sysdate, #{owner})
	</insert>
	<update id="changename" parameterType="fileDTO">
		update BEfilelist set filename = #{filename}, orgname = #{orgname} where num = #{num}
	</update>
	<select id="checksharekey" resultType="int" parameterType="String">
		select count(*) from BEkeylist where share_key = #{code}
	</select>
	<select id="getchmod" resultType="int" parameterType="powerDTO">
		select chmod from BEpowerlist where term = #{term} and randw = #{randw}
	</select>
	<select id="chmodcheck" resultType="int" parameterType="powerDTO">
		select count(*) from BEpowerlist where term = #{term} and randw = #{randw}
	</select>
	<insert id="setchmod" parameterType="powerDTO">
		insert into BEpowerlist(chmod, term, randw) values(BEpowerlist_seq.NEXTVAL, #{term}, #{randw})
	</insert>
	<insert id="sharefile" parameterType="keyDTO">
		insert into BEkeylist(share_key, filenum, chmod) values(#{share_key}, #{filenum}, #{chmod})
	</insert>
	<select id="keycheck" parameterType="keyDTO" resultType="String">
		select share_key from BEkeylist where filenum = #{filenum} and chmod = #{chmod}
	</select>
	<select id="getchmod2" parameterType="String" resultType="int">
		select chmod from BEkeylist where share_key = #{share_key}
	</select>
	<insert id="getsharedfile" parameterType="shareDTO">
		insert into BEsharelist(num,share_key,chmod,nickname) values(BEsharelist_seq.NEXTVAL, #{share_key}, #{chmod}, #{nickname})
	</insert>
</mapper>